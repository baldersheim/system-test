# Copyright Yahoo. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.

schema test {

  fieldset default {
    fields: title
  }

  document test {
    field title type string {
      indexing: index | summary
    }
    field order type int {
      indexing: attribute | summary
    }
    field mixed type tensor(x{},y[2]) {
      indexing: attribute
    }
  }

  rank-profile default {
    first-phase {
      expression: attribute(order)
    }
  }

  rank-profile withmf {
    inputs {
      query(mix) tensor(x{},y[2])
      query(vec) tensor(y[2])
    }
    function score_per_x() {
      expression: reduce(query(mix) * tensor(x{},y[2]):{{x:"x1",y:0}:5.000,{x:"x1",y:1}:5.125,{x:"x2",y:0}:5.250,{x:"x2",y:1}:5.375,{x:"x3",y:0}:5.500,{x:"x3",y:0}:5.750} * attribute(mixed), sum, y)
    }
    first-phase {
      expression: attribute(order)
    }
    match-features {
      value(2)
      attribute(order)
      attribute(mixed)
      rankingExpression(score_per_x)
      nativeFieldMatch
      query(vec)
    }
  }

}
